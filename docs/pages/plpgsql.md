writing nice plpgsql

use lowercase
raise notice
use UDTs
use all the features of the database